clc
clear all
close all

n=13;  %no. of elements 
node=8;
dof=2;
s=node*dof;
E=1.9e9;
L=3;
sum=0;
%Transformation matrix set up
l2=[1	1	1	1	0.5	0	0.362181322	0	0.362181322	0	0.5	0.899317755	0.899317755];
m2=[0	0	0	0	0.5	1	0.637818678	1	0.637818678	1	0.5	0.100682245	0.100682245];
lm=[0	0	0	0	0.5	0	0.480630848	0	-0.480630848	0	-0.5	0.300907512	-0.300907512];

k=[2533333.333	2533333.333	2533333.333	2533333.333	1791337.179	2533333.333	1520000	1900000	1520000 ...
    2533333.333	1791337.179	2403331.022	2403331.022];

%K[e] assembly
for i=1:n
Ke(:,:,i)=k(i)*[l2(i) lm(i) -l2(i) -lm(i);     
        lm(i) m2(i) -lm(i) -m2(i);
        -l2(i) -lm(i) l2(i) lm(i);
        -lm(i) -m2(i) lm(i) m2(i)];
end 

%Global matricies set up
for i=1:n
G(:,:,i)=zeros(s);
end

Ke(:,:,1);
G(1:4,1:4,1)=Ke(:,:,1);

Ke(:,:,2);
G(3:6,3:6,2)=Ke(:,:,2);

Ke(:,:,3);
G(5:8,5:8,3)=Ke(:,:,3);

Ke(:,:,4);
G(7:10,7:10,4)=Ke(:,:,4);

Ke(:,:,5);
G(1:2,1:2,5)=Ke(1:2,1:2,5);
G(1:2,11:12,5)=Ke(1:2,3:4,5);
G(11:12,1:2,5)=Ke(3:4,1:2,5);
G(11:12,11:12,5)=Ke(3:4,3:4,5);

Ke(:,:,6);
G(3:4,3:4,6)=Ke(1:2,1:2,6);
G(3:4,11:12,6)=Ke(1:2,3:4,6);
G(11:12,3:4,6)=Ke(3:4,1:2,6);
G(11:12,11:12,6)=Ke(3:4,3:4,6);

Ke(:,:,7);
G(3:4,3:4,7)=Ke(1:2,1:2,7);
G(3:4,13:14,7)=Ke(1:2,3:4,7);
G(13:14,3:4,7)=Ke(3:4,1:2,7);
G(13:14,13:14,7)=Ke(3:4,3:4,7);

Ke(:,:,8);
G(5:6,5:6,8)=Ke(1:2,1:2,8);
G(5:6,13:14,8)=Ke(1:2,3:4,8);
G(13:14,5:6,8)=Ke(3:4,1:2,8);
G(13:14,13:14,8)=Ke(3:4,3:4,8);

Ke(:,:,9);
G(7:8,7:8,9)=Ke(1:2,1:2,9);
G(7:8,13:14,9)=Ke(1:2,3:4,9);
G(13:14,7:8,9)=Ke(3:4,1:2,9);
G(13:14,13:14,9)=Ke(3:4,3:4,9);

Ke(:,:,10);
G(7:8,7:8,10)=Ke(1:2,1:2,10);
G(7:8,15:16,10)=Ke(1:2,3:4,10);
G(15:16,7:8,10)=Ke(3:4,1:2,10);
G(15:16,15:16,10)=Ke(3:4,3:4,10);

Ke(:,:,11);
G(9:10,9:10,11)=Ke(1:2,1:2,11);
G(9:10,15:16,11)=Ke(1:2,3:4,11);
G(15:16,9:10,11)=Ke(3:4,1:2,11);
G(15:16,15:16,11)=Ke(3:4,3:4,11);

Ke(:,:,12);
G(11:14,11:14,12)=Ke(:,:,12);

Ke(:,:,13);
G(13:16,13:16,13)=Ke(:,:,13);

%summation of Global matricies
for i=1:n
    sum=sum+G(:,:,i);
end
Gs=sum;
G_full=sum;

%Forces matrix set up
for i=1:s
F(i)=0;
end
%External forces 
F(4)=-30e3;
F(6)=-30e3;
F(11)=-50e3;
F(8)=-90e3;
F_full=F'
%BCs
Gs(13:14,:)=[];
Gs(:,13:14)=[];

Gs(9:10,:)=[];
Gs(:,9:10)=[];

Gs(2,:)=[];
Gs(:,2)=[];

F(14)=[];
F(13)=[];
F(10)=[];
F(9)=[];
F(2)=[];

U=Gs\F';

%Reput to get full U 
U_full=[U(1);0;U(2);U(3);U(4);U(5);U(6);U(7);0;0;U(8);U(9);0;0;U(10);U(11)]

%Reactions
R=(G_full*U_full-F_full);

%Change any member to local Co. (member 2 as example)
for e=1:n
    l(e)=l2(e)^0.5;
    m(e)=m2(e)^0.5;
end

T=[l(2) m(2) 0 0
  -m(2) l(2) 0 0
    0 0 l(2) -m(2)
   0 0 m(2) l(2)];

u=T\[U_full(3) U_full(4) U_full(5) U_full(6)]'


%Stress in member(2)
S=(E/L)*[-l(2) -m(2) l(2) m(2)]* [U_full(3) U_full(4) U_full(5) U_full(6)]'
SS=(E/L)*(u(3)-u(1))
  
